<!DOCTYPE html>
<html lang="ckb">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="گەنجینەی ئیسلام -  فەرموودە، هاوەڵانی پەیامبەر، ژیاننامە، و زۆر تر">
    <title>گەنجینەی ئیسلام</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="apple-touch-icon" href="assets/logo.png">
</head>
<body>
    <script>
        if (localStorage.getItem('sidebarOpen') === 'true') {
            document.body.classList.add('sidebar-open');
        }
    </script>
    <!-- ==================== HEADER ==================== -->
    <header>
        <div class="header-container">
            <button id="sidebarToggle"><i class="fas fa-bars-staggered"></i> بەشەکان</button>
            <div class="logo"><i class="fa-solid fa-kaaba"></i> گەنجینەی ئیسلام</div>
            <nav id="navMenu">
                <div class="nav-scroll-wrapper">
                    <ul>
                        <li><a href="index.html" class="active">سەرەتا</a></li>
                        <li><a href="../islam-what/index.html">ئیسلام چییە؟</a></li>
                        <li><a href="../aqidah/index.html">عەقیدە</a></li>
                        <li><a href="../tawheed/index.html">تەوحید</a></li>
                        <li><a href="../quran/index.html">قوڕئان</a></li>
                        <li><a href="../hadiths/index.html">فەرموودە</a></li>
                        <li><a href="../prayer/index.html">نوێژ</a></li>
                        <li><a href="../biography/index.html">ژیاننامە</a></li>
                        <li><a href="../companions/index.html">هاوەڵان</a></li>
                        <li><a href="../dhikr/index.html">یادی خودا</a></li>
                        <li><a href="../video/index.html">ڤیدیۆ</a></li>
                        <li><a href="../library-media/index.html">کتێبخانە</a></li>
                        <li><a href="../faq/index.html">پرسیار و وەڵام</a></li>
                    </ul>
                </div>
            </nav>
        </div>
    </header>

    <!-- ==================== HERO SECTION ==================== -->
    <section class="hero">
        <h1>گەنجینەی ئیسلام</h1>
        <p>بۆ خزمەتی ئاینی خودای تاك</p>
        <div class="hero-notification">
            <i class="fas fa-bell"></i> پەرستشەکان وەکو عیبادەت ئەنجام بدەن نەك وەکو عادەت
        </div><br>
        <button class="cta-button" onclick="document.querySelector('main').scrollIntoView({behavior: 'smooth'})">ئاشنا بوون بە ئیسلام</button>
    </section>

    <!-- ==================== PRAYER TIMES SECTION ==================== -->
    <section class="prayer-section-home">
        <div class="prayer-times-container">
            <h2 class="section-title-home">
                <i class="fas fa-mosque"></i> کاتەکانی نوێژ
                <span class="city-select-container">(<select id="city-selector" class="city-selector-inline" aria-label="هەڵبژاردنی شار">
                    <option value="Erbil">هەولێر</option>
                    <option value="Sulaymaniyah">سلێمانی</option>
                    <option value="Duhok">دهۆك</option>
                    <option value="Kirkuk">کەرکووک</option>
                    <option value="Halabja">هەڵەبجە</option>
                </select>)</span>
            </h2>
            <p id="hijri-date" class="date-display"></p>
            <div class="prayer-times" id="home-prayer-times">
                <div class="loading-spinner-full-width">
                    <i class="fas fa-spinner fa-spin fa-2x"></i>
                </div>
            </div>
            <div id="next-prayer-countdown" class="next-prayer-display"></div>
        </div>
    </section>

        <!-- ==================== MAIN CONTENT ==================== -->

        <main>
            <section class="sections-grid">
                <div class="section-card" onclick="window.location.href='islam-what/index.html'">
                    <div class="section-icon"><i class="fas fa-question-circle"></i></div>
                    <h3>ئیسلام چییە؟</h3>
                    <p>پێناسەی ئیسلام و بنەماکانی</p>
                </div>
                <div class="section-card" onclick="window.location.href='aqidah/index.html'">
                    <div class="section-icon"><i class="fa-duotone fa-solid fa-mosque"></i></div>
                    <h3>عەقیدە</h3>
                    <p>کۆمەڵێك پرسیار و وەڵام و بەڵگەی عەقیدەیی</p>
                </div>
                <div class="section-card" onclick="window.location.href='tawheed/index.html'">
                    <div class="section-icon"><i class="fa-solid fa-hand-point-up"></i></div>
                    <h3>تەوحید</h3>
                    <p>یەکخاپەرستی و پێوانەکانی</p>
                </div>
                 <div class="section-card" onclick="window.location.href='quran/index.html'">
                    <div class="section-icon"><i class="fas fa-quran"></i></div>
                    <h3>قوڕئان</h3>
                    <p>کۆمەڵێك زانیاری لەسەر قوڕئان</p>
                </div>
                <div class="section-card" onclick="window.location.href='hadiths/index.html'">
                    <div class="section-icon"><i class="fas fa-book"></i></div>
                    <h3>فەرموودەکان</h3>
                    <p>سەحیحی بوخاری، سەحیحی موسلیم و دیکە</p>
                </div>
                 <div class="section-card" onclick="window.location.href='prayer/index.html'">
                    <div class="section-icon"><i class="fa-solid fa-person-praying"></i></div>
                    <h3>نوێژ</h3>
                    <p>چۆنییەتی نوێژکردن و بابەتەکان</p>
                </div>
                 <div class="section-card" onclick="window.location.href='biography/index.html'">
                    <div class="section-icon"><i class="fas fa-scroll"></i></div>
                    <h3>ژیاننامەی پەیامبەر</h3>
                    <p>ژیانی پێش ئیسلام و دوای ئیسلام</p>
                </div>
                <div class="section-card" onclick="window.location.href='companions/index.html'">
                    <div class="section-icon"><i class="fas fa-users"></i></div>
                    <h3>هاوەڵانی پەیامبەر</h3>
                    <p>باسی کۆمەڵێك هاوەڵی دیار</p>
                </div>
                 <div class="section-card" onclick="window.location.href='dhikr/index.html'">
                    <div class="section-icon"><i class="fas fa-hands-praying"></i></div>
                    <h3>یادی خودا</h3>
                    <p>فێربوونی یادکردنەوەی خودا</p>
                </div>
                <div class="section-card" onclick="window.location.href='../video/index.html'">
                    <div class="section-icon"><i class="fa-solid fa-clapperboard"></i></div>
                    <h3>ڤیدیۆ</h3>
                    <p>ڕووقیە ، قوڕئان ، ووتار و هیتر</p>
                </div>
                <div class="section-card" onclick="window.location.href='library-media/index.html'">
                    <div class="section-icon"><i class="fas fa-book-open"></i></div>
                    <h3>کتێبخانە</h3>
                    <p>پەرتووکخانەی ئیسلام</p>
                </div>
                <div class="section-card" onclick="window.location.href='faq/index.html'">
                    <div class="section-icon"><i class="fas fa-comments"></i></div>
                    <h3>پرسیار و وەڵام (FAQ)</h3>
                    <p>وەڵامدانەوەی پرسیارە باوەکان</p>
                </div>
            </section>

        </main>

    <!-- ==================== STATS SECTION ==================== -->
    <section class="stats-section">
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-users"></i></div>
                <span class="stat-number" id="home-visitor-stat">0</span>
                <span class="stat-label">کۆی سەردانیکەران</span>
            </div>
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-download"></i></div>
                <span class="stat-number" id="download-stat">0</span>
                <span class="stat-label">کتێبە دابەزێنراوەکان</span>
            </div>
        </div>
    </section>

    

        <!-- ==================== FOOTER ==================== -->

       <footer>
        <p class="copyright">&copy; 2026 هەموو مافەکان پارێزراوە بۆ گەنجینەی ئیسلام.</p>
        
        <div class="footer-socials">
            <!-- لینکی فەیسبووک -->
            <a href="https://www.facebook.com/share/1ZrBaxzyfp/" target="_blank" rel="noopener noreferrer" class="social-btn facebook" title="Facebook">
                <i class="fab fa-facebook-f"></i>
            </a>
            
            <!-- لینکی ئینستاگرام -->
            <a href="https://www.instagram.com/mabast.w?igsh=MWx4ZHk1a2pncjBrcA==" target="_blank" rel="noopener noreferrer" class="social-btn instagram" title="Instagram">
                <i class="fab fa-instagram"></i>
            </a>
            
            <!-- لینکی یوتوب -->
            <a href="https://youtube.com/@mabast.1491?si=ZtEd5wFa2hPEpiiQ" target="_blank" rel="noopener noreferrer" class="social-btn youtube" title="YouTube">
                <i class="fab fa-youtube"></i>
            </a>
            
            <!-- ئیمەیڵ (Gmail) -->
            <a href="mailto:mabastw.qadir@gmail.com" class="social-btn email" title="Email">
                <i class="fas fa-envelope"></i>
            </a>
        </div>

        <p class="developer">گەشەپێدەر / مەبەست وریا خەیلانی</p>
    </footer>

    

        <script src="js/script.js"></script>

        <script src="js/theme.js"></script>

    

        <!-- Supabase Integration -->

        <script type="module">

            import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

    

            const supabaseUrl = 'https://sftnwbgwbxkmuackksho.supabase.co'

            const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNmdG53Ymd3YnhrbXVhY2trc2hvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc5NTIxNTAsImV4cCI6MjA4MzUyODE1MH0.ArdAj5hPfNskzYDHitg5W6y9MGNkMFwAIwG9ep0MpBw'

            const supabase = createClient(supabaseUrl, supabaseKey)

            async function initPrayerTimes() {
                const container = document.getElementById('home-prayer-times');
                const dateEl = document.getElementById('hijri-date');
                const countdownEl = document.getElementById('next-prayer-countdown');
                const citySelector = document.getElementById('city-selector');
                const cityNameDisplay = document.getElementById('city-name-display');

                if (!container) return;

                const savedCity = localStorage.getItem('selectedCity') || 'Erbil';

                if (citySelector) {
                    citySelector.value = savedCity;

                    const updateCityDisplay = () => {
                        const selectedOption = citySelector.options[citySelector.selectedIndex];
                        if (cityNameDisplay) cityNameDisplay.innerText = `(${selectedOption.text})`;
                    };
                    updateCityDisplay();

                    citySelector.addEventListener('change', (e) => {
                        localStorage.setItem('selectedCity', e.target.value);
                        updateCityDisplay();
                        fetchPrayerTimes(e.target.value);
                    });
                }

                function renderPrayerTimes(data) {
                    const timings = data.data.timings;
                    const date = data.data.date;

                    if (dateEl) {
                        dateEl.innerHTML = `<i class="far fa-calendar-alt"></i> ${date.hijri.day} ${date.hijri.month.ar} ${date.hijri.year} | ${date.gregorian.date}`;
                    }

                    const prayers = [
                        { key: 'Fajr', name: 'بەیانی', icon: 'fa-cloud-sun' },
                        { key: 'Sunrise', name: 'خۆرھەڵات', icon: 'fa-sun' },
                        { key: 'Dhuhr', name: 'نیوەڕۆ', icon: 'fa-sun' },
                        { key: 'Asr', name: 'عەسر', icon: 'fa-cloud-sun' },
                        { key: 'Maghrib', name: 'مەغریب', icon: 'fa-moon' },
                        { key: 'Isha', name: 'عیشا', icon: 'fa-star' }
                    ];

                    container.innerHTML = '';

                    prayers.forEach(p => {
                        const card = document.createElement('div');
                        card.className = 'prayer-time';
                        card.innerHTML = `
                            <div class="prayer-name"><i class="fas ${p.icon}"></i> ${p.name}</div>
                            <div class="prayer-time-value">${timings[p.key]}</div>
                        `;
                        container.appendChild(card);
                    });

                    if (window.prayerCountdownInterval) clearInterval(window.prayerCountdownInterval);

                    const updateCountdown = () => {
                        const now = new Date();
                        const prayerNames = {
                            'Fajr': 'بەیانی',
                            'Sunrise': 'خۆرھەڵات',
                            'Dhuhr': 'نیوەڕۆ',
                            'Asr': 'عەسر',
                            'Maghrib': 'مەغریب',
                            'Isha': 'عیشا'
                        };
                        const prayerOrder = ['Fajr', 'Sunrise', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];

                        let nextPrayer = null;
                        let nextPrayerTime = null;
                        let nextPrayerName = '';

                        for (let key of prayerOrder) {
                            const timeStr = timings[key];
                            const [hours, minutes] = timeStr.split(':').map(Number);
                            const prayerDate = new Date();
                            prayerDate.setHours(hours, minutes, 0, 0);

                            if (prayerDate > now) {
                                nextPrayer = key;
                                nextPrayerTime = prayerDate;
                                nextPrayerName = prayerNames[key];
                                break;
                            }
                        }

                        if (!nextPrayer) {
                            const timeStr = timings['Fajr'];
                            const [hours, minutes] = timeStr.split(':').map(Number);
                            nextPrayerTime = new Date();
                            nextPrayerTime.setDate(nextPrayerTime.getDate() + 1);
                            nextPrayerTime.setHours(hours, minutes, 0, 0);
                            nextPrayerName = prayerNames['Fajr'];
                        }

                        const diff = nextPrayerTime - now;
                        const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                        const seconds = Math.floor((diff % (1000 * 60)) / 1000);

                        if (countdownEl) {
                            countdownEl.innerHTML = `کاتی ماوە بۆ نوێژی <span style="color: #1db954;">${nextPrayerName}</span> : <span style="font-family: 'Cairo', sans-serif; font-size: 1.3em; font-weight: 800; color: white; letter-spacing: 1px;">${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}</span>`;
                        }
                    };

                    updateCountdown();
                    window.prayerCountdownInterval = setInterval(updateCountdown, 1000);
                }

                async function fetchPrayerTimes(city) {
                    container.innerHTML = '<div class="loading-spinner-full-width"><i class="fas fa-spinner fa-spin fa-2x"></i></div>';

                    const today = new Date().toISOString().split('T')[0]; // Get YYYY-MM-DD
                    const cacheKey = `prayer-times-${city}-${today}`;
                    const cachedData = localStorage.getItem(cacheKey);

                    if (cachedData) {
                        // Loading from cache
                        renderPrayerTimes(JSON.parse(cachedData));
                        return;
                    }

                    // Fetching from API
                    try {
                        const response = await fetch(`https://api.aladhan.com/v1/timingsByCity?city=${city}&country=Iraq&method=3`);
                        const data = await response.json();

                        if (data.code === 200) {
                            localStorage.setItem(cacheKey, JSON.stringify(data));
                            // Clear old cache entries
                            Object.keys(localStorage).forEach(key => {
                                if (key.startsWith('prayer-times-') && key !== cacheKey) {
                                    localStorage.removeItem(key);
                                }
                            });
                            renderPrayerTimes(data);
                        } else {
                             container.innerHTML = '<p class="error-message-full-width">کێشەیەک هەیە لە وەرگرتنی کاتەکان</p>';
                        }
                    } catch (err) {
                        console.error('Error loading prayer times:', err);
                        container.innerHTML = '<p class="error-message-full-width">کێشەیەک هەیە لە پەیوەستبوون بە ئینتەرنێت</p>';
                    }
                }

                fetchPrayerTimes(savedCity);
            }
    

            async function initStats() {

                const homeStatEl = document.getElementById('home-visitor-stat');

                const downloadStatEl = document.getElementById('download-stat');

    

                try {

                    // 1. Increment & Get Global Visitor Count

                    if (homeStatEl) {

                        const { data, error } = await supabase.rpc('increment_global_visitor_count');

                        if (!error) homeStatEl.innerText = data.toLocaleString();

                    }

    

                    // 2. Get Total Book Downloads

                    if (downloadStatEl) {

                        const { data: downloads, error: dlError } = await supabase.rpc('get_total_book_downloads');

                        if (!dlError) downloadStatEl.innerText = downloads.toLocaleString();

                    }

    

                } catch (err) { console.error('Error updating stats:', err); }

            }

            document.addEventListener('DOMContentLoaded', () => {

                initStats();
                initPrayerTimes();

            });

        </script>
</body>
</html>
