<!DOCTYPE html>
<html lang="ckb">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>عەقیدەی ئیسلامی - گەنجینەی ئیسلام</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="manifest" href="../manifest.json">
    <link rel="apple-touch-icon" href="../assets/logo.png">

    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NC6X5E2XKK"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NC6X5E2XKK');
</script>
</head>
<body>
    <script>
        if (localStorage.getItem('sidebarOpen') === 'true') {
            document.body.classList.add('sidebar-open');
        }
    </script>
    
    <header>
        <div class="header-container">
            <button id="sidebarToggle"><i class="fas fa-bars-staggered"></i> بەشەکان</button>
            <div class="logo"><i class="fa-sharp-duotone fa-solid fa-kaaba"></i> گەنجینەی ئیسلام</div>
            <nav id="navMenu">
                <div class="nav-scroll-wrapper">
                    <ul>
                         <li><a href="../index.html">سەرەتا</a></li>
                        <li><a href="../islam-what/index.html">ئیسلام چییە؟</a></li>
                        <li><a href="index.html" class="active">عەقیدە</a></li>
                        <li><a href="../tawheed/index.html">تەوحید</a></li>
                        <li><a href="../quran/index.html">قوڕئان</a></li>
                        <li><a href="../hadiths/index.html">فەرموودە</a></li>
                        <li><a href="../prayer/index.html">نوێژ</a></li>
                        <li><a href="../biography/index.html">ژیاننامە</a></li>
                        <li><a href="../companions/index.html">هاوەڵان</a></li>
                        <li><a href="../dhikr/index.html">یادی خودا</a></li>
                        <li><a href="../video/index.html">ڤیدیۆ</a></li>
                        <li><a href="../library-media/index.html">کتێبخانە</a></li>
                        <li><a href="../faq/index.html">پرسیار و وەڵام</a></li>
                    </ul>
                </div>
            </nav>
        </div>
    </header>

    <main>
        <div class="hadith-page-container">
            <div class="hadith-header-row">
                <div class="hadith-title-section">
                    <h2><i class="fa-duotone fa-solid fa-mosque text-green"></i> عەقیدەی ئیسلامی</h2>
                    <p>ئەو شتە پته‌وەیە کە مرۆڤ گرێی دەدات بە ناخی خۆیەوە و دەبێتە بناغەی هەڵسوکەوت و بیرکردنەوەی.</p>
                </div>
                <div class="hadith-search-container">
                    <input type="text" class="hadith-search-input" placeholder="گەڕان لە بابەتەکانی عەقیدە..." oninput="filterAqidah(this.value)">
                    <i class="fas fa-search hadith-search-icon"></i>
                </div>
            </div>

            <div class="hadith-grid" id="aqidah-container">
                <div class="loading-spinner loading-spinner-center">
                    <i class="fas fa-spinner fa-spin fa-2x"></i>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <p class="copyright">&copy; 2026 هەموو مافەکان پارێزراوە بۆ گەنجینەی ئیسلام.</p>
        
        <div class="footer-socials">
            <!-- لینکی فەیسبووک -->
            <a href="https://www.facebook.com/share/1ZrBaxzyfp/" target="_blank" rel="noopener noreferrer" class="social-btn facebook" title="Facebook">
                <i class="fab fa-facebook-f"></i>
            </a>
            
            <!-- لینکی ئینستاگرام -->
            <a href="https://www.instagram.com/mabast.w?igsh=MWx4ZHk1a2pncjBrcA==" target="_blank" rel="noopener noreferrer" class="social-btn instagram" title="Instagram">
                <i class="fab fa-instagram"></i>
            </a>
            
            <!-- لینکی یوتوب -->
            <a href="https://youtube.com/@mabast.1491?si=ZtEd5wFa2hPEpiiQ" target="_blank" rel="noopener noreferrer" class="social-btn youtube" title="YouTube">
                <i class="fab fa-youtube"></i>
            </a>
            
            <!-- ئیمەیڵ (Gmail) -->
            <a href="mailto:mabastw.qadir@gmail.com" class="social-btn email" title="Email">
                <i class="fas fa-envelope"></i>
            </a>
        </div>

        <p class="developer">گەشەپێدەر / مەبەست وریا خەیلانی</p>
    </footer>

    <script src="../js/script.js"></script>
    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

        const supabaseUrl = 'https://sftnwbgwbxkmuackksho.supabase.co'
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNmdG53Ymd3YnhrbXVhY2trc2hvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc5NTIxNTAsImV4cCI6MjA4MzUyODE1MH0.ArdAj5hPfNskzYDHitg5W6y9MGNkMFwAIwG9ep0MpBw'
        const supabase = createClient(supabaseUrl, supabaseKey)
        
        // گۆڕاوەکان بۆ پەڕەبەندی (Pagination)
        let aqidahData = [];
        let filteredData = [];
        let currentPage = 1;
        const itemsPerPage = 5;

        // فەنکشن بۆ گۆڕینی بەڵگەکان (تەنها لە لاپتۆپ کار دەکات بەهۆی CSS)
        window.switchEvidence = (btn, index) => {
            const section = btn.closest('.aqidah-evidence-section');
            if(!section) return;
            
            // نوێکردنەوەی دوگمەکان
            section.querySelectorAll('.evidence-dot').forEach(d => d.classList.remove('active'));
            btn.classList.add('active');
            
            // نوێکردنەوەی بەڵگەکان
            section.querySelectorAll('.evidence-item').forEach((item, i) => {
                if(i === index) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
        };

        // فەنکشن بۆ پیشاندان/شاردنەوەی بەڵگەکان لە مۆبایل
        window.toggleMobileEvidence = (btn) => {
            const container = btn.closest('.aqidah-content-body');
            const section = container.querySelector('.aqidah-evidence-section');
            
            if (section.classList.contains('show')) {
                section.classList.remove('show');
                btn.innerHTML = '<i class="fas fa-eye"></i> پیشاندانی بەڵگەکان';
                btn.classList.remove('active');
            } else {
                section.classList.add('show');
                btn.innerHTML = '<i class="fas fa-eye-slash"></i> شاردنەوەی بەڵگەکان';
                btn.classList.add('active');
            }
        };

        // فەنکشن بۆ گۆڕینی پەڕە
        window.changeAqidahPage = (page) => {
            currentPage = page;
            renderPage();
            // Scroll to top of container
            const container = document.getElementById('aqidah-container');
            if(container) {
                const headerOffset = 120;
                const elementPosition = container.getBoundingClientRect().top;
                const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
                window.scrollTo({
                    top: offsetPosition,
                    behavior: "smooth"
                });
            }
        }

        // فەنکشنی ناوخۆیی بۆ پیشاندانی پەڕەی دیاریکراو
        function renderPage() {
            const container = document.getElementById('aqidah-container');
            if (!container) return;

            if (filteredData.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #94a3b8; grid-column: 1/-1;">هیچ بابەتێک نەدۆزرایەوە.</p>';
                return;
            }

            const totalPages = Math.ceil(filteredData.length / itemsPerPage);
            
            if (currentPage < 1) currentPage = 1;
            if (currentPage > totalPages) currentPage = totalPages;

            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const pageData = filteredData.slice(start, end);

            const cardsHTML = pageData.map((item, index) => {
                // ژمارەی پرسیارەکە بەپێی داتای گشتی (بۆ ئەوەی ژمارەکان تێک نەچن)
                const questionNumber = aqidahData.indexOf(item) + 1;

                // کۆکردنەوەی هەموو بەڵگەکان لە یەک لیستدا
                let allEvidences = [];

                // بەڵگەکانی قورئان
                if (item.quran_evidences && Array.isArray(item.quran_evidences)) {
                    item.quran_evidences.forEach(e => allEvidences.push({...e, type: 'quran'}));
                } else if (item.quran_ar) {
                    allEvidences.push({ ar: item.quran_ar, ku: item.quran_ku, source: item.quran_source, type: 'quran' });
                }

                // بەڵگەکانی فەرموودە
                if (item.hadith_evidences && Array.isArray(item.hadith_evidences)) {
                    item.hadith_evidences.forEach(e => allEvidences.push({...e, type: 'hadith'}));
                } else if (item.hadith_ar) {
                    allEvidences.push({ ar: item.hadith_ar, ku: item.hadith_ku, source: item.hadith_source, type: 'hadith' });
                }

                const hasEvidence = allEvidences.length > 0;

                // دروستکردنی HTML بۆ بەڵگەکان
                const evidencesHTML = allEvidences.map((ev, i) => `
                    <div class="evidence-item ${ev.type} ${i === 0 ? 'active' : ''}">
                        <div class="evidence-header">
                            <i class="fas ${ev.type === 'quran' ? 'fa-quran' : 'fa-scroll'}"></i>
                            ${ev.type === 'quran' ? 'بەڵگەی قوڕئانی' : 'بەڵگەی فەرموودەیی'}
                        </div>
                        <div class="evidence-content-ar">${ev.ar}</div>
                        <div class="evidence-content-ku">${ev.ku}</div>
                        <div class="evidence-ref">${ev.source}</div>
                    </div>
                `).join('');

                // دروستکردنی دوگمەکانی ژمارە (Pagination)
                const paginationHTML = allEvidences.length > 1 ? `
                    <div class="evidence-pagination">
                        ${allEvidences.map((_, i) => `
                            <button class="evidence-dot ${i === 0 ? 'active' : ''}" onclick="switchEvidence(this, ${i})">${i + 1}</button>
                        `).join('')}
                    </div>
                ` : '';

                return `
                    <div class="aqidah-card ${hasEvidence ? 'has-evidence' : ''}">
                        <div class="aqidah-question-section">
                            <i class="fas fa-question-circle aqidah-question-icon"></i>
                            <div class="question-label"><i class="fas fa-circle-question"></i> پرسیار ${questionNumber}</div>
                            <div class="question-text-ar">${item.question_ar}</div>
                            <div class="question-text-ku">${item.question_ku}</div>
                        </div>
                        
                        <div class="aqidah-content-body">
                            <div class="aqidah-answer-section">
                                <div class="answer-label"><i class="fas fa-lightbulb"></i> وەڵام</div>
                                <div class="answer-text-ar">${item.answer_ar}</div>
                                <div class="answer-text-ku">${item.answer_ku}</div>
                            </div>

                            ${hasEvidence ? `
                            <button class="mobile-evidence-toggle" onclick="toggleMobileEvidence(this)">
                                <i class="fas fa-eye"></i> پیشاندانی بەڵگەکان
                            </button>
                            <div class="aqidah-evidence-section">
                                <div class="evidence-wrapper">
                                    ${evidencesHTML}
                                </div>
                                ${paginationHTML}
                            </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');

            // دروستکردنی دوگمەکانی پەڕەبەندی
            let paginationControls = '';
            if (totalPages > 1) {
                paginationControls = '<div class="pagination-container">';
                
                // دوگمەی پێشوو
                if (currentPage > 1) {
                    paginationControls += `<button class="pagination-btn" onclick="changeAqidahPage(${currentPage - 1})"><i class="fas fa-chevron-right"></i></button>`;
                }

                // ژمارەی پەڕەکان
                for (let i = 1; i <= totalPages; i++) {
                    if (totalPages > 7) {
                        if (i === 1 || i === totalPages || (i >= currentPage - 1 && i <= currentPage + 1)) {
                            paginationControls += `<button class="pagination-btn ${i === currentPage ? 'active' : ''}" onclick="changeAqidahPage(${i})">${i}</button>`;
                        } else if (i === currentPage - 2 || i === currentPage + 2) {
                            paginationControls += `<span class="pagination-dots">...</span>`;
                        }
                    } else {
                        paginationControls += `<button class="pagination-btn ${i === currentPage ? 'active' : ''}" onclick="changeAqidahPage(${i})">${i}</button>`;
                    }
                }

                // دوگمەی داهاتوو
                if (currentPage < totalPages) {
                    paginationControls += `<button class="pagination-btn" onclick="changeAqidahPage(${currentPage + 1})"><i class="fas fa-chevron-left"></i></button>`;
                }

                paginationControls += '</div>';
            }

            container.innerHTML = cardsHTML + paginationControls;
        }

        // فەنکشنێک بۆ وەرگرتنی داتاکان و ئامادەکردنیان
        function renderAqidah(data) {
            const container = document.getElementById('aqidah-container');
            
            if (!data) {
                console.error('هەڵە: داتا نەگەیشت.');
                container.innerHTML = '<p style="text-align: center; color: red;">کێشەیەک هەیە لە پەیوەستبوون بە داتابەیس. کۆنسۆڵ (Console) ببینە.</p>';
                return;
            }

            if (data.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #94a3b8;">هیچ بابەتێک نەدۆزرایەوە.</p>';
                return;
            }

            aqidahData = data;
            filteredData = data;
            currentPage = 1;
            renderPage();
        }

        window.filterAqidah = (query) => {
            query = query.toLowerCase();
            filteredData = aqidahData.filter(item => {
                const text = (item.question_ar + item.question_ku + item.answer_ar + item.answer_ku).toLowerCase();
                return text.includes(query);
            });
            currentPage = 1;
            renderPage();
        }

        // بەکارهێنانی فەنکشنە ئامادەکراوەکەی ناو script.js
        document.addEventListener('DOMContentLoaded', () => {
            // پارامیتەرەکان: ناوی خشتە، فەنکشنی دیزاین، سوپابەیس
            window.fetchAndCacheData('aqidah', renderAqidah, supabase);
        });
    </script>
</body>
</html>